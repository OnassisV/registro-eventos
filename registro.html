<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Evento</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="form-container">
        <h1>Registrar Evento</h1>
        <form id="event-form">
            <!-- Fecha de Partida -->
            <label for="fecha-partida">Fecha de Partida:</label>
            <input type="date" id="fecha-partida" required>
            
            <!-- Fecha de Retorno -->
            <label for="fecha-retorno">Fecha de Retorno:</label>
            <input type="date" id="fecha-retorno" required>
            
            <!-- Asistentes -->
            <label>Asistentes:</label>
            <table id="asistentes-container" class="asistentes-table">
                <tr>
                    <td><label><input type="checkbox" value="Jesus Tamayo"> Jesus Tamayo</label></td>
                    <td><label><input type="checkbox" value="Olinda Martinez"> Olinda Martinez</label></td>
                    <td><label><input type="checkbox" value="Janet Principe"> Janet Principe</label></td>
                </tr>
                <tr>
                    <td><label><input type="checkbox" value="Elsa Herrera"> Elsa Herrera</label></td>
                    <td><label><input type="checkbox" value="Karin Rivas"> Karin Rivas</label></td>
                    <td><label><input type="checkbox" value="Liliana Puchuri"> Liliana Puchuri</label></td>
                </tr>
                <tr>
                    <td><label><input type="checkbox" value="Milagros Rafael"> Milagros Rafael</label></td>
                    <td><label><input type="checkbox" value="Benjamin Paz y Mino"> Benjamin Paz</label></td>
                </tr>
            </table>
            
            <!-- Departamento -->
            <label for="departamento">Departamento:</label>
            <select id="departamento" required>
                <option value="">Seleccione...</option>
                <option value="Amazonas">Amazonas</option>
                <option value="Áncash">Áncash</option>
                <option value="Apurímac">Apurímac</option>
                <option value="Arequipa">Arequipa</option>
                <option value="Ayacucho">Ayacucho</option>
                <!-- Agregar más departamentos según sea necesario -->
            </select>
            
            <!-- Provincia -->
            <label for="provincia">Provincia:</label>
            <select id="provincia" required>
                <option value="">Seleccione...</option>
            </select>
            
            <!-- Temas Tratados -->
            <label for="temas">Temas Tratados:</label>
            <textarea id="temas" rows="4" placeholder="Escriba los temas tratados..." required></textarea>
            
            <!-- Botones -->
            <div class="button-container">
                <button type="submit">Guardar</button>
                <button type="button" onclick="window.location.href='menu.html'">Salir</button>
            </div>
        </form>
        <p id="success-message" class="hidden">¡Evento registrado con éxito!</p>
    </div>
    <script>
// Referencias al DOM
const form = document.getElementById('event-form');
const successMessage = document.getElementById('success-message');
const departamentoSelect = document.getElementById('departamento');
const provinciaSelect = document.getElementById('provincia');

// Datos de departamentos y provincias del Perú
const provinciasPorDepartamento = {
    "Amazonas": ["Chachapoyas", "Bagua", "Bongará", "Condorcanqui", "Luya", "Rodríguez de Mendoza", "Utcubamba"],
    "Áncash": ["Huaraz", "Aija", "Antonio Raimondi", "Asunción", "Bolognesi", "Carhuaz", "Carlos Fermín Fitzcarrald", "Casma", "Corongo", "Huari", "Huarmey", "Huaylas", "Mariscal Luzuriaga", "Ocros", "Pallasca", "Pomabamba", "Recuay", "Santa", "Sihuas", "Yungay"],
    "Apurímac": ["Abancay", "Andahuaylas", "Antabamba", "Aymaraes", "Cotabambas", "Chincheros", "Grau"],
    "Arequipa": ["Arequipa", "Camana", "Caraveli", "Castilla", "Caylloma", "Condesuyos", "Islay", "La Unión"],
    "Ayacucho": ["Huamanga", "Cangallo", "Huanca Sancos", "Huanta", "La Mar", "Lucanas", "Parinacochas", "Páucar del Sara Sara", "Sucre", "Víctor Fajardo", "Vilcas Huamán"],
    // Agrega más departamentos y provincias según sea necesario
};

// Manejo del cambio en el departamento
departamentoSelect.addEventListener('change', () => {
    const departamentoSeleccionado = departamentoSelect.value;
    provinciaSelect.innerHTML = '<option value="">Seleccione...</option>'; // Resetear opciones

    if (provinciasPorDepartamento[departamentoSeleccionado]) {
        provinciasPorDepartamento[departamentoSeleccionado].forEach(provincia => {
            const option = document.createElement('option');
            option.value = provincia;
            option.textContent = provincia;
            provinciaSelect.appendChild(option);
        });
    }
});

// Manejo del evento de formulario
form.addEventListener('submit', async function (event) {
    event.preventDefault(); // Evita el envío estándar del formulario

    // Recopilar datos del formulario
    const fechaPartida = document.getElementById('fecha-partida').value;
    const fechaRetorno = document.getElementById('fecha-retorno').value;
    const asistentes = Array.from(
        document.querySelectorAll('#asistentes-container input:checked')
    ).map(input => input.value).join(', ');
    const departamento = departamentoSelect.value;
    const provincia = provinciaSelect.value;
    const temas = document.getElementById('temas').value;

    // Crear un objeto con los datos
    const evento = {
        fechaPartida,
        fechaRetorno,
        asistentes,
        departamento,
        provincia,
        temas,
    };

    try {
        // Enviar datos al backend
        const response = await fetch('http://localhost:3000/guardar-registro', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(evento),
        });

        if (response.ok) {
            console.log('Datos enviados correctamente');
            successMessage.classList.remove('hidden');
            setTimeout(() => {
                successMessage.classList.add('hidden');
                form.reset(); // Reiniciar el formulario
                provinciaSelect.innerHTML = '<option value="">Seleccione...</option>'; // Resetear provincias
            }, 3000);
        } else {
            console.error('Error al enviar datos:', await response.text());
        }
    } catch (error) {
        console.error('Error al conectar con el servidor:', error);
    }
});

</script>
</body>
</html>